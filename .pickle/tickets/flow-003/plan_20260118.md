# Flow-State & Burnout Shield Implementation Plan

## Overview
Transform the `PomodoroTimer` into a dynamic focus tool with multiple presets, an auto-count-up "Flow Mode," and a "Burnout Shield" to enforce breaks.

## Current State Analysis
- `src/PomodoroTimer.jsx`: Basic countdown (Line 4-23). Resets on task change (Line 26-29).

## Implementation Approach
1. **State Extension**: Add `mode` (timer/flow/break), `preset` (15/25/45/60), and `cumulativeFocus` state.
2. **Preset UI**: Add a row of "Paper" buttons for duration selection.
3. **Flow Logic**: When countdown hits zero, if `isFlowMode` is enabled, transition to `counting-up`.
4. **Burnout Shield**: Track `totalSeconds` focused. If it exceeds 5400 (90 mins), trigger a "Lockout" state that forces a 5-min break.

## Phase 1: State & UI Presets
### Overview
Add the duration selection and mode toggles.

### Changes Required:
#### 1. `src/PomodoroTimer.jsx`
**Changes**: Update `useState` and add preset selection UI.
```javascript
  const PRESETS = [15, 25, 45, 60];
  const [selectedPreset, setSelectedPreset] = useState(25);
  const [isFlowMode, setIsFlowMode] = useState(false);
  const [totalFocusTime, setTotalFocusTime] = useState(0); // in seconds
  const [isBurnedOut, setIsBurnedOut] = useState(false);
```

## Phase 2: Flow Mode & Count-up Logic
### Overview
Update the `useEffect` timer to handle counting up after zero.

### Changes Required:
#### 1. `src/PomodoroTimer.jsx`
**Changes**: Update the timer logic.
```javascript
  useEffect(() => {
    let interval = null;
    if (isActive && !isBurnedOut) {
      interval = setInterval(() => {
        setTimeLeft((time) => {
          if (time <= 0 && isFlowMode) {
            return time - 1; // Negative time = counting up
          }
          if (time === 0) {
            setIsActive(false);
            return 0;
          }
          return time - 1;
        });
        setTotalFocusTime(t => t + 1);
      }, 1000);
    }
    return () => clearInterval(interval);
  }, [isActive, isFlowMode, isBurnedOut]);
```

## Phase 3: Burnout Shield
### Overview
Implement the 90-minute lockout.

### Changes Required:
#### 1. `src/PomodoroTimer.jsx`
**Changes**: Add lockout check.
```javascript
  useEffect(() => {
    if (totalFocusTime >= 90 * 60) {
      setIsBurnedOut(true);
      setIsActive(false);
    }
  }, [totalFocusTime]);
```

### Success Criteria:
#### Automated:
- [ ] `bun run test` (Add tests for flow state)
#### Manual:
- [ ] **Presets**: Click '45', verify timer sets to 45:00.
- [ ] **Flow**: Let timer hit 00:00 with Flow enabled, verify it starts counting up (e.g., -00:01).
- [ ] **Burnout**: Manually set `totalFocusTime` to 5400, verify UI enters "Lockout" state.
