# Archive Rack Protocol Implementation Plan

## Overview
Refactor the UI to a 3-pane layout: a sidebar for project selection and an execution workspace for subtask management.

## Current State Analysis
- `App.jsx`: Single column for everything.
- `TodoList.jsx`: Renders all todos and their subtasks inline.

## Implementation Approach
1. **State Refactor**: Add selection logic to `App.jsx`.
2. **Sidebar Component**: Create `TaskSidebar.jsx`. Move `AddTodo` there.
3. **Workspace Component**: Create `TaskDetail.jsx` to show subtasks of the selected task.
4. **Layout Refactor**: Update CSS Grid to accommodate the new 3-pane structure.

## Phase 1: State & Selection (rack-001)
### Overview
Add the navigation state to `App.jsx`.

### Changes Required:
#### 1. `src/App.jsx`
**Changes**: Add `selectedTodoId` state and selection logic.
```javascript
  const [selectedTodoId, setSelectedTodoId] = useState(() => {
    const savedId = localStorage.getItem('paper-selected-todo');
    return savedId || null;
  });

  useEffect(() => {
    if (selectedTodoId) {
      localStorage.setItem('paper-selected-todo', selectedTodoId);
    }
  }, [selectedTodoId]);

  // Fallback selection
  useEffect(() => {
    if (!selectedTodoId && todos.length > 0) {
      setSelectedTodoId(todos[0].id);
    }
  }, [todos, selectedTodoId]);
```

## Phase 2: Sidebar & Components (rack-002)
### Overview
Build the new components.

### Changes Required:
#### 1. `src/TaskSidebar.jsx` (New File)
**Changes**: List tasks with progress indicators.
```jsx
// Sidebar logic here...
```

## Phase 3: Layout & Workspace (rack-003)
### Overview
Update the grid and filter the workspace.

### Changes Required:
#### 1. `src/index.css`
**Changes**: Update `.paper-container` and add `.app-layout`.
```css
.app-layout {
  display: grid;
  grid-template-columns: 250px 1fr; /* Sidebar | Workspace */
  height: 100vh;
  overflow: hidden;
}
```

### Success Criteria:
#### Automated:
- [ ] `bun run build`
#### Manual:
- [ ] **Selection**: Click task in sidebar, main paper updates.
- [ ] **Creation**: Add task in sidebar, it appears and is selectable.
- [ ] **Detail**: Workspace only shows steps for the active project.
