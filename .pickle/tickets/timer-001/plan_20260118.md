# God Mode Pomodoro Timer Implementation Plan

## Overview
Implement a custom Pomodoro timer and link it to subtask completion. This involves state lifting in `App.jsx`, a new `PomodoroTimer` component, and UI updates for focusing on subtasks.

## Current State Analysis
- `App.jsx`: Manages subtask state.
- `SubTaskItem.jsx`: Displays subtask, lacks "Focus" trigger.

## Implementation Approach
1.  **State Setup**: Add `activeSubTask` state to `App.jsx`.
2.  **Focus Action**: Add a "Focus" button to `SubTaskItem`.
3.  **Pomodoro Component**: Build `src/PomodoroTimer.jsx` from scratch.
    -   Features: 25m countdown, Start/Pause/Reset, Display active subtask name.
4.  **Auto-Stop Logic**: Update `toggleSubTask` in `App.jsx` to stop the timer if the active subtask is completed.

## Phase 1: State & Focus Trigger
### Overview
Prepare the plumbing for the timer.

### Changes Required:
#### 1. `src/App.jsx`
**Changes**: Add `activeSubTask` state and `startFocus` function.
```jsx
  const [activeSubTask, setActiveSubTask] = useState(null);

  const startFocus = (todoId, subTaskId) => {
    setActiveSubTask({ todoId, subTaskId });
  };
  
  // Update toggleSubTask to clear focus if completed
  const toggleSubTask = (todoId, subTaskId) => {
    setTodos(todos.map(todo => {
      if (todo.id === todoId) {
        return {
          ...todo,
          subTasks: todo.subTasks.map(st => {
            if (st.id === subTaskId) {
               const newCompleted = !st.completed;
               if (newCompleted && activeSubTask?.subTaskId === subTaskId) {
                 setActiveSubTask(null);
               }
               return { ...st, completed: newCompleted };
            }
            return st;
          })
        };
      }
      return todo;
    }));
  };
```

#### 2. `src/SubTaskItem.jsx`
**Changes**: Add Focus button.
```jsx
function SubTaskItem({ subTask, onToggle, onDelete, onFocus, isFocused }) {
  return (
    <div className={`sub-task-item ${isFocused ? 'focused' : ''}`} ...>
      ...
      <button onClick={() => onFocus(subTask.id)}>Focus</button>
      ...
    </div>
  );
}
```

## Phase 2: Pomodoro Component
### Overview
The "God Mode" timer.

### Changes Required:
#### 1. `src/PomodoroTimer.jsx` (New File)
**Changes**: Custom countdown logic.
```jsx
import React, { useState, useEffect } from 'react';

function PomodoroTimer({ activeSubTask, onComplete }) {
  const [timeLeft, setTimeLeft] = useState(25 * 60);
  const [isActive, setIsActive] = useState(false);

  useEffect(() => {
    let interval = null;
    if (isActive && timeLeft > 0) {
      interval = setInterval(() => setTimeLeft(t => t - 1), 1000);
    } else if (timeLeft === 0) {
      setIsActive(false);
      onComplete();
    }
    return () => clearInterval(interval);
  }, [isActive, timeLeft, onComplete]);

  // Format time...
  // Style with Paper aesthetic...
}
```

### Success Criteria:
#### Automated:
- [ ] `bun run test` (Add timer test)
#### Manual:
- [ ] **Focus Link**: Click Focus on a subtask, verify timer updates.
- [ ] **Auto-Stop**: Check the focused subtask, verify timer stops/clears.
