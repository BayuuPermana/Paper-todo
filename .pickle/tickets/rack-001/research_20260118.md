# Research: Archive Rack Protocol - State & Logic

**Date**: 2026-01-18

## 1. Executive Summary
The refactor requires moving from a flat "show everything" list to a "master-detail" pattern. Centralizing the selection logic in `App.jsx` is the most efficient path to ensure all sibling components (Sidebar, Workspace, Timer) stay in sync.

## 2. Technical Context
- **State Source**: `src/App.jsx` manages `todos` (Line 11).
- **Mutations**: Standard array mapping for updates and filtering for deletions.
- **Navigation**: No current navigation state exists.

## 3. Findings & Analysis
- **Selection State**: `const [selectedTodoId, setSelectedTodoId] = useState(null);` is required.
- **Initialization**: An `useEffect` or initial state logic should select the first available todo if `selectedTodoId` is null.
- **Deletion Edge Case**: If the currently selected todo is deleted, `selectedTodoId` must be cleared or updated to the next available ID.
- **Workspace Filtering**: The main `paper-container` will filter the `todos` array based on `selectedTodoId` to render the detail view.

## 4. Technical Constraints
- **State Persistence**: `localStorage` currently saves the whole `todos` array. We should probably also save the `selectedTodoId` so the user returns to where they left off.
- **UUIDs**: All IDs are `v4` UUIDs, so direct comparison is safe.

## 5. Architecture Documentation
- Pattern: Master-Detail.
- Component Role: `TaskSidebar` (Master), `TaskDetail` (Detail - to be created).
