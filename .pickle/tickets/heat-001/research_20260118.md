# Research: Persistent Completion Logging & Scoring

**Date**: 2026-01-18

## 1. Executive Summary
To enable a heatmap visualization, the application requires a persistent record of productivity events. We will implement a scoring engine where main tasks are worth 3 points and subtasks are worth 1 point. This data will be stored as an aggregated log to optimize for long-term storage and retrieval.

## 2. Technical Context
- **State Location**: `src/App.jsx`.
- **Mutation Points**: 
    - `toggleComplete` (Line 132).
    - `toggleSubTask` (Line 171).
- **Persistence**: Currently uses `STORAGE_KEY = 'paper-todos'`. We will add `LOG_KEY = 'paper-activity-log'`.

## 3. Findings & Analysis
- **Scoring**: 
    - Task Completion: 3 pts.
    - Subtask Completion: 1 pt.
- **Data Structure**: To minimize space, we will store a daily aggregate rather than individual timestamps:
    `{ "2026-01-18": { pts: 5, completions: 4 }, ... }`
- **Logic**: When an item is toggled, we compare the new state with the old state. We only add points if `completed` becomes `true`. If it becomes `false`, we subtract points (Undo support).

## 4. Technical Constraints
- **State Sync**: The log must update atomically with the todo list state.
- **Date Handling**: Use ISO strings (`YYYY-MM-DD`) derived from `new Date().toLocaleDateString('en-CA')` to avoid timezone shifting.

## 5. Architecture Documentation
- Store: `localStorage`.
- Component Role: `App.jsx` acts as the log controller.
