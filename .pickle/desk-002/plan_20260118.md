# App State Migration Implementation Plan

## Overview
Refactor `App.jsx` to use SQLite for all data operations.

## Current State Analysis
- `App.jsx`: Synchronous initialization from `localStorage`.
- `App.jsx`: Global `useEffect` for persistence.

## Implementation Approach
1. Modify `App.jsx` initialization: Start with empty state and load from DB in `useEffect`.
2. Implement migration logic: Move data from `localStorage` to SQLite on first run.
3. Update all action handlers to be `async` and call `db.js` functions.
4. Remove global persistence `useEffect`s.

## Phase 1: App.jsx Refactor
### Overview
Migrate data loading and saving logic.

### Changes Required:
#### 1. `src/App.jsx`
**Changes**: Update state initialization and handlers.

```javascript
// ... imports
import { getTodos, saveTodo, deleteTodoDb, getActivityLog, saveActivityLog } from './db';

// ... inside App component
const [todos, setTodos] = useState([]);
const [activityLog, setActivityLog] = useState({});

useEffect(() => {
  const loadData = async () => {
    // 1. Check for migration
    const saved = localStorage.getItem('paper-todos');
    if (saved) {
      const parsed = JSON.parse(saved);
      for (const t of parsed) {
        await saveTodo(t);
      }
      localStorage.removeItem('paper-todos');
      // Do same for activity log...
    }

    // 2. Load from DB
    const dbTodos = await getTodos();
    const dbLog = await getActivityLog();
    setTodos(dbTodos);
    setActivityLog(dbLog);
  };
  loadData();
}, []);

// Update handlers to save to DB...
```

### Success Criteria:
#### Manual:
- [ ] App loads data from SQLite on startup.
- [ ] New tasks are saved to SQLite.
- [ ] Reordering is persisted in SQLite.
- [ ] Existing localStorage data is migrated correctly.
