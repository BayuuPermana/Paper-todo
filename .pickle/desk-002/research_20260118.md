# Research: App State Migration to SQLite

**Date**: 2026-01-19

## 1. Executive Summary
Refactor `App.jsx` to use the `db.js` utility for all data persistence, replacing the synchronous `localStorage` logic with asynchronous database calls.

## 2. Technical Context
- **Current State**: `todos` and `activityLog` are initialized from `localStorage` synchronously.
- **Problem**: Database calls are asynchronous. Initial state must be handled carefully to avoid UI flashes or empty states.

## 3. Findings & Analysis
- **Initialization**: Use a `useEffect` with an empty dependency array to load data from SQLite on mount.
- **State Sync**: Instead of a global `useEffect` that saves everything on every change (which is inefficient for DBs), we should update the DB inside the specific action handlers (`addTodo`, `toggleComplete`, etc.).
- **LocalStorage Migration**: On first launch in Tauri, check if `localStorage` has data. If yes, migrate it to SQLite and then clear `localStorage`.

## 4. Technical Constraints
- `react-beautiful-dnd` needs the reordered state to be updated immediately in the UI.
- Images can be large; ensure they are handled as text strings (base64) in the DB.

## 5. Architecture Documentation
- Handler Refactor: `const addTodo = async (text, image) => { ... await saveTodo(newTodo); setTodos([...todos, newTodo]); }`
