# Subtask Drag-and-Drop Implementation Plan

## Overview
Implement reordering functionality for subtasks within a todo item using `react-beautiful-dnd`.

## Current State Analysis
- `App.jsx` has a `DragDropContext` that only handles `sidebar-todos`.
- `TodoItem.jsx` renders subtasks as a static list.
- `onDragEnd` logic in `App.jsx` only handles top-level reordering.

## Implementation Approach
1. Move `DragDropContext` in `App.jsx` to wrap the entire layout or use separate contexts if necessary. Actually, since they are separate routes (sidebar vs detail), I'll expand the existing context or use a high-level one.
2. Update `handleDragEnd` to detect `droppableId`. If it starts with `subtasks-`, reorder subtasks within that todo.
3. Update `TodoItem.jsx` to use `StrictModeDroppable` and wrap `SubTaskItem` in `Draggable`.

## Phase 1: Context and Handler Update
### Overview
Modify `App.jsx` to handle subtask drag-and-drop events.

### Changes Required:
#### 1. `src/App.jsx`
**Changes**:
- Expand `handleDragEnd` to check `source.droppableId`.
- If `source.droppableId.startsWith('subtasks-')`, extract the `todoId` and reorder its `subTasks`.
- Move `DragDropContext` to wrap the outer `app-layout` div to encompass both Sidebar and Paper Container.

```javascript
  const handleDragEnd = (result) => {
    if (!result.destination) return;
    const { source, destination } = result;

    saveHistory();

    if (source.droppableId === 'sidebar-todos') {
      const items = Array.from(todos);
      const [reorderedItem] = items.splice(source.index, 1);
      items.splice(destination.index, 0, reorderedItem);
      setTodos(items);
    } else if (source.droppableId.startsWith('subtasks-')) {
      const todoId = source.droppableId.replace('subtasks-', '');
      setTodos(prev => prev.map(todo => {
        if (todo.id === todoId) {
          const newSubTasks = Array.from(todo.subTasks);
          const [reordered] = newSubTasks.splice(source.index, 1);
          newSubTasks.splice(destination.index, 0, reordered);
          return { ...todo, subTasks: newSubTasks };
        }
        return todo;
      }));
    }
  };
```

## Phase 2: TodoItem Component Update
### Overview
Implement DnD UI components in `TodoItem.jsx`.

### Changes Required:
#### 1. `src/TodoItem.jsx`
**Changes**:
- Import `Draggable` from `react-beautiful-dnd` and `StrictModeDroppable` from `./StrictModeDroppable`.
- Wrap the subtasks list in `StrictModeDroppable` with `droppableId={`subtasks-${todo.id}`}`.
- Wrap each `SubTaskItem` in `Draggable`.

```jsx
<StrictModeDroppable droppableId={`subtasks-${todo.id}`}>
  {(provided) => (
    <div 
      className="sub-tasks-list" 
      style={{ marginLeft: '20px', marginTop: '5px' }}
      {...provided.droppableProps}
      ref={provided.innerRef}
    >
      {todo.subTasks && todo.subTasks.map((subTask, index) => (
        <Draggable key={subTask.id} draggableId={subTask.id} index={index}>
          {(provided, snapshot) => (
            <div
              ref={provided.innerRef}
              {...provided.draggableProps}
              {...provided.dragHandleProps}
              style={{
                ...provided.draggableProps.style,
                marginBottom: '5px'
              }}
            >
              <SubTaskItem ... />
            </div>
          )}
        </Draggable>
      ))}
      {provided.placeholder}
    </div>
  )}
</StrictModeDroppable>
```

## Success Criteria:
#### Manual:
- [ ] Drag a subtask to a new position; it should stay there.
- [ ] Sidebar dragging still works.
- [ ] No "orphan" Draggable errors in console.
